---
title: "Übersicht über bisherige Ergebnisse"
author: "Julia Hoepler, Lena Zelinka, Benedikt Arnthof"
date: "17.11.2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      eval = TRUE,
                      out.width = "80%",
                      fig.align = "center")
require(ggplot2)
require(ggmap)
```


## Zeitliche Verteilung der Publicity-Aktionen und der Eintraege in das Crowdsourcing-Tool:
### Graphik dreigeteilt in die Jahre 2017, 2018 und 2019
### orangefarbene Balken stellen die Publicity-Aktionen dar
### schwarze Balken stellen Belege dar

```{r zeitliche Verteilung(Publicity-Aktionen und Eintraege), echo=FALSE, warning=FALSE}
plt_publicity <- function(df, days, year, size = 2) {
  plt <- ggplot(df, aes(x = days, y = freq)) +
    geom_bar(stat = "identity", col = "black") +
    ylim(0, 600) +
    theme_bw() + 
    theme(axis.text = element_text(size = 18, face = "bold"),
          axis.title = element_text(size = 18, face = "bold")) +
    xlab(year) +
    ylab("Anzahl Eintraege in Datenbank")
  # constructing values for geom_segment
  values <- numeric(length = length(days))
  for (i in seq_along(days)) {
    tmp <- df$freq[df$days == as.Date(days[i])]
    values[i] <- if (length(tmp) == 0) {
      0
    } else {tmp}
  }
  segment_data = data.frame(
    x = as.Date(days),
    xend = as.Date(days), 
    y = values,
    yend = rep(600, times = length(days))
  )
  # adding the segments to the plot
  plt <- plt + geom_segment(data = segment_data, 
                            aes(x = x, y = y, xend = xend, yend = yend), 
                            col = "#ff8000", alpha = 0.75, size = size)
  plt
}
df2017 <- readRDS("df2017.RDS")
df2018 <- readRDS("df2018.RDS")
df2019 <- readRDS("df2019.RDS")
pubdays2017 <- readRDS("pubdays2017.RDS")
pubdays2018 <- readRDS("pubdays2018.RDS")
pubdays2019 <- readRDS("pubdays2019.RDS")
plt_publicity(df2017, pubdays2017, "2017", size = 1.4)
plt_publicity(df2018, pubdays2018, "2018", size = 1.4)
plt_publicity(df2019, pubdays2019, "2019", size = 1.4)
```

## Dichteplot der Einträge durch das Crowdsourcing-Tool (blau)
### Die roten Punkte geben die Orte der User an, die die meisten Einträge gemacht haben (Power User)

```{r spatial, include=FALSE}
sp_crowd <- readRDS("sp_crowd.RDS")
box <- sp_crowd@bbox
box[2,] <- c(44, 49)
df <- readRDS("lastone.RDS")
map <- get_stamenmap(bbox = box, zoom = 7, maptype = "toner") 
plt <- ggmap(map) +
  geom_point(aes(x = lng, y = lat, size = sqrt(Freq), col = sqrt(Freq)),
             data = df, alpha = .5)
plt
# Räumliche Verteilung der Einträge in die Datenbank
plt2 <- ggmap(map) +
  stat_density2d(aes(x = lng, y = lat),
  col = "blue", fill = "blue", alpha = 0.1, size = 1, bins = 10, data = df, geom = "polygon"
) 
plt2
# 2D Dichteplot der Verteilung der Einträge in die Datenbank
uniquepoints <- readRDS("uniquepoints.RDS")
plt3 <- plt2 +
  geom_point(aes(x = lng, y = lat, size = count), data = uniquepoints, col = "red")
plt3
# Lokationen der 10 "Power User"; Also der 10 Benutzer welche die meisten Beiträge
# zur Datenbank hinzufügten.
```
```{r Dichteplot, Power User, echo = FALSE, warning=FALSE}
uniquepoints <- readRDS("uniquepoints.RDS")
plt3 <- plt2 +
  geom_point(aes(x = lng, y = lat, size = count), data = uniquepoints, col = "red")
plt3
```

## Ein paar Kenngroeßen für einen besseren Überblick:
```{r raeumliche Verteilung, include=FALSE}
require(sf)
require(raster)
require(sp)
require(mapview)
crowd01 <- read.csv("~/statprakt/crowd01.csv", encoding = "UTF-8", sep = ",")
coords <- crowd01$Georeferenz
coords <- as.character(coords)

geo <- sub("POINT", "", coords)
geo <- sub("\\(", "", geo)
geo <- sub("\\)", "", geo)

list2 <- stringr::str_split(geo, " ")
one <- sapply(list2, `[[`, 1)
two <- sapply(list2, `[[`, 2)

Breite_crowd01 <- two
Laenge_crowd01 <- one

Breite_crowd01 <- as.numeric(Breite_crowd01)

Laenge_crowd01 <- as.numeric(Laenge_crowd01)
```

```{r raeumliche Verteilung, Kenngroeßen, warning=FALSE}
## Kenngrößen 
# Mittelwert von den Breitengraden in "crowd01"
mean(Breite_crowd01)

# Mittelwert von den Laengengraden in "crowd01"
mean(Laenge_crowd01)

## Streuung

# Varianz der Breitengrade
var(Breite_crowd01)

# Varianz der Laengengrade
var(Laenge_crowd01) 

# Standardabweichung der Breitengrade
sd(Breite_crowd01)

# Standardabweichung der Laengengrade
sd(Laenge_crowd01)

# Variationsbreite der Breitengrade

# Variationsgrade der Laengengrade
range(Laenge_crowd01) 

## Kenngrößen Zusammenfassung
summary(Laenge_crowd01)

summary(Breite_crowd01)
```

## absolute und relative Häufigkeit der Hauptkategorien

```{r Hauptkategorie, echo=FALSE, warning=FALSE}
library(ggplot2)

#Entferne Duplikate, im einen Überblick über die Hauptkategorien zu erlangen
Hauptkategorie2 <- unique(crowd01$Hauptkategorie)

#Erstelle Barplot von den abs. Haeufigkeiten der Belege je Hauptkategorie
 
library("reshape2")

test2 <- melt(crowd01$Hauptkategorie)

mlt <- melt(table(test2))

mlt$test2 <- as.character(mlt$test2)
which(mlt$test2 == "Milchverarbeitung")
mlt$test2[9] <- "Milchv."

which(mlt$test2 == "Holzverarbeitung")
mlt$test2[6] <- "Holzv."

which(mlt$test2 == "Landschaftsformationen")
mlt$test2[8] <- "Landf."

ggplot(mlt, aes(reorder(x = test2, - value), y = value)) + 
  geom_bar(stat = "identity", fill = "brown1") + 
  geom_text(aes(label = value), vjust = 0) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + labs(x = "") + 
  ggtitle("Anzahl der Eintraege je Hauptkategorie") + theme(plot.title = element_text(hjust = 0.5))

mlt$relativ <- mlt$value/sum(mlt$value)
mlt$relativ <- round(mlt$relativ, digits = 2)

ggplot(mlt, aes(reorder(x = test2, - mlt$relativ), y = mlt$relativ)) + 
  geom_bar(stat = "identity", fill = "brown1") + 
  geom_text(aes(label = mlt$relativ), vjust = -0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + labs(x = "", y = "rel. Haeufigkeit") + 
  ggtitle("Anteil der Eintraege je Hauptkategorie") + theme(plot.title = element_text(hjust = 0.5))

##Bemerkung:
#"Milchv." = Milchverarbeitung
#"Holzv." = "Holzverarbeitung" 
#"Landf." = Landschaftsformationen
```

## absolute und relative Häufigkeiten der Kategorien

```{r Kategorie, echo=FALSE, warning=FALSE}
library(reshape2)

#Plot über absolute Haeufigkeiten
test2 <- melt(crowd01$Kategorie)
plot_Kategorie <- melt(table(test2))
ggplot(plot_Kategorie,aes(reorder(x = test2, -value), y = value)) + 
  geom_bar(stat = "identity", fill = "brown1", color = "black", alpha = 0.85) + 
  geom_text(aes(label = value), vjust = -0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "") + 
  ggtitle ("Anzahl der Eintraege je Kategorie") +
  theme(plot.title = element_text(hjust = 0.5))


#relativen Haeufigkeiten berechnet
mlt$relative <- mlt$value/(sum(mlt$value))
mlt$relative <- round(mlt$relative, digits = 3)
head(mlt$relative)

#Plot mit relativen Haefigkeiten erstellen
test2 <- melt(crowd01$Kategorie)
plot_relative <- melt(table(test2))
plot_relative$relative <- round(plot_relative$value/(sum(plot_relative$value)), digits = 3)

ggplot(plot_relative,aes(reorder(x = test2, -plot_relative$relative),
                         y = plot_relative$relative)) + 
  geom_bar(stat = "identity", fill = "brown1", color = "black", alpha = 0.85) + 
  geom_text(aes(label = plot_relative$relative), vjust = -0.5) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(x = "", y = "rel. Haeufigkeit") + 
  ggtitle ("Anteil der Eintraege je Kategorie") +
  theme(plot.title = element_text(hjust = 0.5))


```